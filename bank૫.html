<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <title>рк╡рк╣рк┐ркпрк╛ ркмркЪркд ркмрлЗркирлНркХ - рк╕ркВркЪрк╛рк▓рки</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 1150px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        header { 
            text-align: center; 
            background: linear-gradient(135deg, #1a5276 0%, #2980b9 100%); 
            color: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; 
        }

        .logo-img { width: 50px; height: 50px; vertical-align: middle; animation: moveLogo 3s ease-in-out infinite; }
        @keyframes moveLogo { 0%, 100% { transform: translateX(-5px); } 50% { transform: translateX(5px); } }

        header h1 { display: inline-block; margin: 0 15px; font-size: 2.2em; vertical-align: middle; }
        .creator-tag { margin-top: 15px; font-size: 1.1em; color: #ffeb3b; font-weight: bold; background: rgba(0,0,0,0.2); display: inline-block; padding: 5px 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3); }

        .summary-bar { display: flex; justify-content: space-around; background: #d4e6f1; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; color: #1b4f72; }

        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: #fff; }
        h3 { margin-top: 0; color: #1a5276; border-bottom: 2px solid #1a5276; padding-bottom: 5px; }

        input, select { width: 92%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px; transition: 0.3s; }
        
        .btn-blue { background: #2980b9; color: white; }
        .btn-green { background: #27ae60; color: white; }
        .btn-orange { background: #e67e22; color: white; }
        .btn-search { background: #34495e; color: white; width: 30%; margin-left: 5px; }
        .btn-print { background: #2c3e50; color: white; width: auto; padding: 10px 20px; }

        .section-box { margin-top: 30px; padding: 20px; border-radius: 10px; border: 1px solid #ddd; }
        .passbook-section { background: #e8f8f5; border: 1px solid #27ae60; }
        .report-section { background: #fdfefe; border: 1px solid #34495e; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #2c3e50; color: white; }

        .filter-controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; background: #f1f1f1; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .filter-controls span { font-weight: bold; color: #2c3e50; }
        .btn-filter { width: auto !important; padding: 8px 15px !important; margin: 0 !important; font-size: 13px; }

        @media print {
            .grid, .summary-bar, .creator-tag, header h2, .logo-img, button, select, h3, hr, .filter-controls { display: none !important; }
            body { background: white; padding: 0; }
            .container { box-shadow: none; max-width: 100%; border: none; }
            .section-box { border: none; background: white; padding: 0; }
            #passbookResult, #reportContainer { display: block !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <img src="https://cdn-icons-png.flaticon.com/512/2830/2830284.png" class="logo-img">
        <h1>рк╡рк╣рк┐ркпрк╛ ркмркЪркд ркмрлЗркирлНркХ</h1>
        <img src="https://cdn-icons-png.flaticon.com/512/2830/2830284.png" class="logo-img">
        <h2>рк╢рлНрк░рлА ркЬрлА.рк╡рлА.ркШрлЗрк▓рк╛ркгрлА рк╡рк┐ркжрлНркпрк╛рк▓ркп рк╡рк╣рк┐ркпрк╛ рккрлАркПркорк╢рлНрк░рлА ркЧрлБркЬрк░рк╛ркд</h2>
        <div class="creator-tag">тЬНя╕П ркбрк┐ркЭрк╛ркЗркирк░: ркоркирк╕рлБрк░рлА ркЖркХрлАркмрк╣рлБрк╕рлЗрки.ркП.</div>
    </header>

    <div class="summary-bar">
        <span>ркХрлБрк▓ ркЦрк╛ркдрк╛: <span id="totalAcc">0</span></span>
        <span>ркХрлБрк▓ ркмрлЗрк▓рлЗркирлНрк╕: тВ╣ <span id="totalBankBal">0.00</span></span>
    </div>

    <div class="grid">
        <div class="card">
            <h3>ЁЯЖХ ркирк╡рлБркВ ркЦрк╛ркдрлБркВ ркЦрлЛрк▓рлЛ</h3>
            <input type="number" id="newAccNo" placeholder="ркЦрк╛ркдрк╛ ркиркВркмрк░">
            <input type="text" id="newName" placeholder="ркирк╛рко">
            <select id="newCategory">
                <option value="">рк╡рк┐ркнрк╛ркЧ рккрк╕ркВркж ркХрк░рлЛ...</option>
                <option value="ркЖркЪрк╛рк░рлНркп">ркЖркЪрк╛рк░рлНркп</option>
                <option value="рк╢рк┐ркХрлНрк╖ркХ">рк╢рк┐ркХрлНрк╖ркХ</option>
                <option value="ркзрлЛрк░ркг рлм">ркзрлЛрк░ркг рлм</option>
                <option value="ркзрлЛрк░ркг рлн">ркзрлЛрк░ркг рлн</option>
                <option value="ркзрлЛрк░ркг рло">ркзрлЛрк░ркг рло</option>
            </select>
            <input type="number" id="initAmt" placeholder="рк╢рк░рлВркЖркдркирлА рк░ркХрко">
            <button class="btn-blue" onclick="createAccount()">ркЦрк╛ркдрлБркВ ркЦрлЛрк▓рлЛ</button>
        </div>

        <div class="card">
            <h3>ЁЯТ╕ ркЬркорк╛ / ркЙрккрк╛ркб ркПркирлНркЯрлНрк░рлА</h3>
            <div style="display: flex;">
                <input type="number" id="searchAccNo" placeholder="ркЦрк╛ркдрк╛ ркиркВ. рк╕рк░рлНркЪ" style="width: 65%;">
                <button class="btn-search" onclick="searchByAccNo()">рк╕рк░рлНркЪ</button>
            </div>
            <select id="selectAcc" onchange="updateAccountInfo()"></select>
            <p id="accInfo" style="font-size: 0.85em; color: #d35400; font-weight: bold; margin: 5px 0;">рккрк╕ркВркж ркХрк░рлЛ...</p>
            <input type="number" id="txnAmt" placeholder="рк░ркХрко (тВ╣)">
            <button class="btn-green" onclick="processTxn('Deposit')">ркЬркорк╛ ркХрк░рлЛ</button>
            <button class="btn-orange" onclick="processTxn('Withdraw')">ркЙрккрк╛ркб ркХрк░рлЛ</button>
        </div>

        <div class="card">
            <h3>тЪЩя╕П рк╕ркВркЪрк╛рк▓рки</h3>
            <select id="deleteSelectAcc"></select>
            <button style="background:#c0392b; color:white;" onclick="deleteAccount()">ркЦрк╛ркдрлБркВ ркбрк┐рк▓рлАркЯ ркХрк░рлЛ</button>
            <hr>
            <button class="btn-blue" style="background:#95a5a6; font-size:12px;" onclick="exportData()">ЁЯТ╛ ркмрлЗркХркЕркк ркбрк╛ркЙркирк▓рлЛркб</button>
            <button class="btn-blue" style="background:#95a5a6; font-size:12px; margin-top:5px;" onclick="document.getElementById('fileInput').click()">ЁЯУВ ркбрлЗркЯрк╛ рк▓рлЛркб ркХрк░рлЛ</button>
            <input type="file" id="fileInput" style="display:none" onchange="importData(event)">
        </div>
    </div>

    <div class="section-box report-section">
        <h3>ЁЯУК рк╡рлНркпрк╡рк╣рк╛рк░ рк░рк┐рккрлЛрк░рлНркЯрлНрк╕ (Reports)</h3>
        
        <div class="filter-controls">
            <span>рк╕ркоркпркЧрк╛рк│рлЛ:</span>
            <button class="btn-blue btn-filter" onclick="applyFilters('all')">ркдркорк╛рко</button>
            <button class="btn-blue btn-filter" style="background:#8e44ad;" onclick="applyFilters('daily')">ркжрлИркирк┐ркХ</button>
            <button class="btn-blue btn-filter" style="background:#2980b9;" onclick="applyFilters('monthly')">ркорк╛рк╕рк┐ркХ</button>
            <button class="btn-blue btn-filter" style="background:#16a085;" onclick="applyFilters('yearly')">рк╡рк╛рк░рлНрк╖рк┐ркХ</button>
            
            <span style="margin-left:15px;">рк╡рк┐ркнрк╛ркЧ:</span>
            <select id="filterCategory" style="width: auto; min-width: 130px;" onchange="applyFilters()">
                <option value="all">ркмркзрк╛ рк╡рк┐ркнрк╛ркЧ</option>
                <option value="ркЖркЪрк╛рк░рлНркп">ркЖркЪрк╛рк░рлНркп</option>
                <option value="рк╢рк┐ркХрлНрк╖ркХ">рк╢рк┐ркХрлНрк╖ркХ</option>
                <option value="ркзрлЛрк░ркг рлм">ркзрлЛрк░ркг рлм</option>
                <option value="ркзрлЛрк░ркг рлн">ркзрлЛрк░ркг рлн</option>
                <option value="ркзрлЛрк░ркг рло">ркзрлЛрк░ркг рло</option>
            </select>
        </div>

        <div id="reportContainer" style="display: none;">
            <button class="btn-print" onclick="window.print()">ЁЯЦия╕П рк░рк┐рккрлЛрк░рлНркЯ рккрлНрк░рк┐ркирлНркЯ ркХрк░рлЛ</button>
            <h4 id="reportTitle" style="margin: 15px 0; color: #2c3e50; border-left: 5px solid #2c3e50; padding-left: 10px;"></h4>
            <table>
                <thead>
                    <tr>
                        <th>ркдрк╛рк░рлАркЦ</th>
                        <th>ркЦрк╛ркдрк╛ ркиркВ.</th>
                        <th>рк╡рк┐ркнрк╛ркЧ</th>
                        <th>ркирк╛рко</th>
                        <th>рк╡рк┐ркЧркд</th>
                        <th>ркЬркорк╛ (тВ╣)</th>
                        <th>ркЙрккрк╛ркб (тВ╣)</th>
                    </tr>
                </thead>
                <tbody id="reportBody"></tbody>
            </table>
        </div>
    </div>

    <div class="section-box passbook-section">
        <h3>ЁЯУЦ рккрк╛рк╕ркмрлБркХ (рк╡рлНркпркХрлНркдрк┐ркЧркд)</h3>
        <select id="viewPassbookAcc" onchange="viewPassbook()"></select>
        <div id="passbookResult" style="display: none; margin-top: 20px;">
            <button class="btn-print" onclick="window.print()">ЁЯЦия╕П рккрк╛рк╕ркмрлБркХ рккрлНрк░рк┐ркирлНркЯ ркХрк░рлЛ</button>
            <h4 id="passbookOwner" style="background: #f8f9fa; padding: 15px; border: 1px dashed #2980b9; border-radius: 5px; line-height: 1.6;"></h4>
            <table>
                <thead>
                    <tr><th>ркдрк╛рк░рлАркЦ</th><th>рк╡рк┐ркЧркд</th><th>ркЬркорк╛ (тВ╣)</th><th>ркЙрккрк╛ркб (тВ╣)</th><th>ркмрлЗрк▓рлЗркирлНрк╕ (тВ╣)</th></tr>
                </thead>
                <tbody id="passbookBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let bankData = JSON.parse(localStorage.getItem('vahiyaBankDB')) || { students: [] };
    let currentPeriod = 'all';

    function save() {
        localStorage.setItem('vahiyaBankDB', JSON.stringify(bankData));
        render();
    }

    // ркмркзрлА ркПркирлНркЯрлНрк░рлА ркХрлНрк▓рк┐ркпрк░ ркХрк░рк╡рк╛ркирлБркВ ркирк╡рлБркВ рклркВркХрлНрк╢рки
    function clearInputs(type) {
        if(type === 'new') {
            document.getElementById('newAccNo').value = '';
            document.getElementById('newName').value = '';
            document.getElementById('newCategory').value = '';
            document.getElementById('initAmt').value = '';
        } else if(type === 'txn') {
            document.getElementById('searchAccNo').value = '';
            document.getElementById('selectAcc').value = '';
            document.getElementById('txnAmt').value = '';
            document.getElementById('accInfo').innerText = 'рккрк╕ркВркж ркХрк░рлЛ...';
        }
    }

    function createAccount() {
        let accNo = document.getElementById('newAccNo').value;
        let name = document.getElementById('newName').value;
        let cat = document.getElementById('newCategory').value;
        let amt = parseFloat(document.getElementById('initAmt').value);
        if(!accNo || !name || !cat || isNaN(amt)) return alert("ркмркзрлА рк╡рк┐ркЧркд ркнрк░рлЛ");
        if(bankData.students.find(s => s.accNo === accNo)) return alert("ркЦрк╛ркдрк╛ ркиркВркмрк░ рккрк╣рлЗрк▓рлЗркерлА ркЫрлЗ!");
        bankData.students.push({
            accNo: accNo, name: name, category: cat, balance: amt,
            history: [{ date: new Date().toLocaleString(), remark: "рк╢рк░рлВркЖркдркирлА ркЬркорк╛", dep: amt, wd: 0, bal: amt }]
        });
        save();
        clearInputs('new'); // рклрлЛрк░рлНрко ркХрлНрк▓рк┐ркпрк░
        alert("ркЦрк╛ркдрлБркВ ркЦрлБрк▓рлА ркЧркпрлБркВ!");
    }

    function searchByAccNo() {
        let accNo = document.getElementById('searchAccNo').value;
        let index = bankData.students.findIndex(s => s.accNo === accNo);
        if(index !== -1) { 
            document.getElementById('selectAcc').value = index; 
            updateAccountInfo(); 
        }
        else alert("ркЦрк╛ркдрк╛ ркиркВркмрк░ ркорк│рлНркпрлЛ ркиркерлА!");
    }

    function processTxn(type) {
        let index = document.getElementById('selectAcc').value;
        let amt = parseFloat(document.getElementById('txnAmt').value);
        if(index === "" || isNaN(amt) || amt <= 0) return alert("рк╕рк╛ркЪрлА рк░ркХрко рк▓ркЦрлЛ");
        let s = bankData.students[index];
        if(type === 'Withdraw' && amt > s.balance) return alert("ркмрлЗрк▓рлЗркирлНрк╕ ркУркЫрлБркВ ркЫрлЗ!");
        s.balance = (type === 'Deposit') ? s.balance + amt : s.balance - amt;
        s.history.unshift({ date: new Date().toLocaleString(), remark: type === 'Deposit' ? "ркЬркорк╛" : "ркЙрккрк╛ркб", dep: type === 'Deposit' ? amt : 0, wd: type === 'Withdraw' ? amt : 0, bal: s.balance });
        save();
        clearInputs('txn'); // рклрлЛрк░рлНрко ркХрлНрк▓рк┐ркпрк░
        alert("рк╡рлНркпрк╡рк╣рк╛рк░ рк╕рклрк│!");
    }

    function updateAccountInfo() {
        let i = document.getElementById('selectAcc').value;
        if(i!=="") {
            let s = bankData.students[i];
            document.getElementById('accInfo').innerText = `ркирк╛рко: ${s.name} (${s.category}) | тВ╣${s.balance.toFixed(2)}`;
        }
    }

    function applyFilters(period) {
        if(period) currentPeriod = period;
        let selectedCat = document.getElementById('filterCategory').value;
        let allTxns = [];
        let today = new Date();

        bankData.students.forEach(s => {
            if (selectedCat !== 'all' && s.category !== selectedCat) return;

            s.history.forEach(h => {
                let txnDate = new Date(h.date.split(',')[0]);
                let match = false;

                if (currentPeriod === 'all') match = true;
                else if (currentPeriod === 'daily') match = txnDate.toDateString() === today.toDateString();
                else if (currentPeriod === 'monthly') match = txnDate.getMonth() === today.getMonth() && txnDate.getFullYear() === today.getFullYear();
                else if (currentPeriod === 'yearly') match = txnDate.getFullYear() === today.getFullYear();

                if (match) allTxns.push({ ...h, name: s.name, accNo: s.accNo, category: s.category });
            });
        });

        let periodTitle = { 'all':'ркдркорк╛рко', 'daily':'ркжрлИркирк┐ркХ', 'monthly':'ркЖ ркорк╛рк╕ркирлЛ', 'yearly':'ркЖ рк╡рк░рлНрк╖ркирлЛ' }[currentPeriod];
        let title = periodTitle + " - " + (selectedCat === 'all' ? "ркмркзрк╛ рк╡рк┐ркнрк╛ркЧркирлЛ" : selectedCat + " рк╡рк┐ркнрк╛ркЧркирлЛ") + " рк░рк┐рккрлЛрк░рлНркЯ";
        renderReportTable(allTxns, title);
    }

    function renderReportTable(data, title) {
        let tbody = document.getElementById('reportBody');
        document.getElementById('reportTitle').innerText = title;
        let html = data.length ? '' : '<tr><td colspan="7">ркХрлЛркИ рк╡рлНркпрк╡рк╣рк╛рк░ ркорк│рлНркпрк╛ ркиркерлА.</td></tr>';
        data.forEach(h => {
            html += `<tr><td>${h.date}</td><td>${h.accNo}</td><td>${h.category}</td><td>${h.name}</td><td>${h.remark}</td><td style="color:green">${h.dep || '-'}</td><td style="color:red">${h.wd || '-'}</td></tr>`;
        });
        tbody.innerHTML = html;
        document.getElementById('reportContainer').style.display = 'block';
    }

    function viewPassbook() {
        let index = document.getElementById('viewPassbookAcc').value;
        if(index === "") return;
        let s = bankData.students[index];
        document.getElementById('passbookResult').style.display='block';
        document.getElementById('passbookOwner').innerHTML = `рк╡рк┐ркжрлНркпрк╛рк░рлНркерлА: ${s.name} | рк╡рк┐ркнрк╛ркЧ: ${s.category} | ркЦрк╛ркдрк╛ ркиркВ: ${s.accNo} | ркмрлЗрк▓рлЗркирлНрк╕: тВ╣${s.balance.toFixed(2)}`;
        let html = '';
        s.history.forEach(h => html += `<tr><td>${h.date}</td><td>${h.remark}</td><td>${h.dep || '-'}</td><td>${h.wd || '-'}</td><td>${h.bal.toFixed(2)}</td></tr>`);
        document.getElementById('passbookBody').innerHTML = html;
    }

    function render() {
        document.getElementById('totalAcc').innerText = bankData.students.length;
        document.getElementById('totalBankBal').innerText = bankData.students.reduce((a,b)=>a+b.balance,0).toFixed(2);
        let opt = '<option value="">рккрк╕ркВркж ркХрк░рлЛ...</option>';
        bankData.students.forEach((s, i) => opt += `<option value="${i}">${s.accNo} - ${s.name} (${s.category})</option>`);
        document.getElementById('selectAcc').innerHTML = opt;
        document.getElementById('viewPassbookAcc').innerHTML = opt;
        document.getElementById('deleteSelectAcc').innerHTML = opt;
    }

    function exportData() {
        let dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(bankData));
        let dlAnchor = document.createElement('a');
        dlAnchor.setAttribute("href", dataStr); dlAnchor.setAttribute("download", "bank_backup.json"); dlAnchor.click();
    }

    function importData(event) {
        let reader = new FileReader();
        reader.onload = (e) => { bankData = JSON.parse(e.target.result); save(); alert("ркбрлЗркЯрк╛ рк▓рлЛркб ркеркпрлЛ!"); };
        reader.readAsText(event.target.files[0]);
    }

    function deleteAccount() {
        let index = document.getElementById('deleteSelectAcc').value;
        if(index !== "" && confirm("ркбрк┐рк▓рлАркЯ ркХрк░рк╡рлБркВ ркЫрлЗ?")) { bankData.students.splice(index, 1); save(); }
    }

    render();
</script>
</body>
</html>
